# @title #**Project background** 
#This will be a short video introducing the content creator(s) and motivating the research direction of the template.
#The Tech team will add code to format and display the video

!pip install cartopy
!pip install DateTime 
!pip install matplotlib
!pip install pyhdf
!pip install numpy
!pip install pandas
!pip install modis-tools
!pip install 


# the further information on the MODIS data can be found here : https://amanbagrecha.github.io/post/rs_gis/download-modis-data-using-cmr-api-in-python/
#Import the libraries
from modis_tools.auth import ModisSession
from modis_tools.resources import CollectionApi, GranuleApi
from modis_tools.granule_handler import GranuleHandler
from typing_extensions import Literal
from pyhdf.SD import SD, SDC
import numpy as np
from netCDF4 import Dataset
import matplotlib.pyplot as plt
import cartopy.crs as ccrs


#Import the libraries

from modis_tools.auth import ModisSession
from modis_tools.resources import CollectionApi, GranuleApi
from modis_tools.granule_handler import GranuleHandler
from typing_extensions import Literal

#download_modis.py
username = ""  # Update this line with your username 
password = ""  # Update this line with your password
# 1) connect to earthdata
session = ModisSession(username=username, password=password)

# 2) Query the MODIS catalog for collections
collection_client = CollectionApi(session=session)
collections = collection_client.query(short_name="", version="") # Collection short name + version
# Query the selected collection for granules
granule_client = GranuleApi.from_collection(collections[0], session=session)

# 3) Filter the selected granules via spatial and temporal parameters
Israel_bbox = [] # format [x_min, y_min, x_max, y_max] # add min lon,min lat, max lon and max_lat input your preferred location
Israel_granules = granule_client.query(start_date="", end_date="", bounding_box=Israel_bbox)   #choose the start and end dates for the year-month-day you prefer

# 4) Download the granules
GranuleHandler.download_from_granules(Israel_granules, session, threads=-1) 
#NB the file format will be downloaded in hdf 


# from pyhdf.SD import SD, SDC

import numpy as np

file_name = 'D:/modis/modis.hdf'  #path + downloaded modis data

file = SD(file_name, SDC.READ)
file.info()
datasets_dic = file.datasets()
datasets_dic = file.datasets()
print(datasets_dic)
for idx,sds in enumerate(datasets_dic.keys()):
    print( idx,sds )
  sds_obj = file.select('Npp_500m') # select the data variable 

data = sds_obj.get() # get sds data

print( data )
 import pprint

 pprint.pprint( sds_obj.attributes() )
  for key, value in sds_obj.attributes().items():
      print( key, value )
      if key == 'add_offset':
          add_offset = value  
      if key == 'scale_factor':
          scale_factor = value
 data = (data - add_offset) * scale_factor
 data

# Plot the data
plt.imshow(data, cmap='jet')
plt.colorbar()
plt.title('Npp_500m')
plt.show()


import numpy as np
from netCDF4 import Dataset
import matplotlib.pyplot as plt
import cartopy.crs as ccrs
